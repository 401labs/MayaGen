
# Changelog: Admin Dashboard & RBAC Implementation
## Date: 2026-02-10

### üöÄ New Features

#### **1. Admin Dashboard**
We have implemented a comprehensive Admin Dashboard accessible via the **Floating Dock** for users with the `admin` role. The dashboard includes:
- **User Management**: View all users, their roles, and promote/demote users.
- **Activity Logs**: Track user actions (logins, API calls) with location and timestamp.
- **Image Verification**: View all generated images for content moderation.

#### **2. Role-Based Access Control (RBAC)**
- Added a `role` field to the `User` model (`user` or `admin`).
- Updated JWT tokens to include the `role` claim.
- Protected `/admin/**` endpoints in the backend.
- Conditional rendering in the frontend to show/hide admin features.

#### **3. CLI Tool for Admin Management**
We have added a CLI command to manage administrative tasks, specifically creating an admin user.

### üõ†Ô∏è Important Changes (CLI)

**How to Create an Admin User via CLI:**
Running manual SQL scripts is no longer required. You can now promote the first user to admin using the following command:

```bash
cd mayagen-be
uv run main.py create-admin
```

This command connects to the database (handling potential connection issues automatically) and:
1. Ensures the `role` column exists in the `user` table.
2. Promotes the first registered user to `admin` by default.

**To Promote a Specific User:**
If you want to promote a specific user ID (e.g., ID 5) instead of the first user:
```bash
uv run main.py create-admin --id 5
```

### üìÇ Files Modified
- **Backend**:
    - `app/models.py`: Added `role` to `User`.
    - `app/api/auth.py`: Added `role` to token payload.
    - `app/api/admin.py`: Created admin endpoints.
    - `app/cli.py`: Added `create-admin` command.
    - `main.py`: Updated CLI entry point.
- **Frontend**:
    - `src/context/AuthContext.tsx`: Handling user roles.
    - `src/components/layout/AppDock.tsx`: Added Admin icons.
    - `src/app/admin/**`: Created Admin pages.

---
*Generated by MayaGen Assistant*
